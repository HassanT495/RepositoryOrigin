/* reset + sizing */
*, *::before, *::after { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }
.hidden { display: none !important; }

/* theme */
:root{
  --radius: 12px;
  --fade-duration: 1500ms;
  --fade-ease: linear;
  --tile: 32px;
  --ar: 4 / 3;
  --credits-duration: 20000ms;
  --attack-tint: rgb(255,255,255);
}

body.layout-center{
  display:flex; justify-content:center; align-items:center;
  min-height:100vh;
  background:linear-gradient(135deg,#0ea5e9,#9333ea);
}

main.game-shell{
  aspect-ratio: var(--ar);
  width:min(96vw,72vh);
  position:relative; display:flex; align-items:center; justify-content:center;
  padding:16px;
  background:#000; color:#fff;
  border-radius:var(--radius);
  box-shadow:0 8px 24px rgba(0,0,0,.2);
}

#app.game-stage{
  position:relative;
  width:100%; height:100%;
  aspect-ratio: var(--ar);
  background:#000 center/cover no-repeat;
  color:#111;
  border-radius:calc(var(--radius) - 4px);
  overflow:visible;
}

/* canvas fits stage */
canvas#game{
  display:block;
  width:100%;
  height:100%;
  image-rendering: pixelated;
}

.overlay{
  position:absolute; inset:0;
  border-radius:inherit;
  pointer-events:none;
  background:#000;
  opacity:1;
  transition:opacity var(--fade-duration) var(--fade-ease);
  z-index:2;
}
.overlay.is-hidden{ opacity:0; }

/* UI grid */
.ui-grid{
  display:flex; flex-wrap:wrap; gap:12px;
  justify-content:center; align-items:center;
  padding:8px;
}

/* UI Buttons */
.pixel-button{
  appearance:none; border:0; cursor:pointer; user-select:none;
  padding:10px 16px; min-width:50px;
  text-transform:uppercase; letter-spacing:.5px;
  font:700 14px/1 monospace; color:var(--txt,#111);
  border-radius:10px;
  background:linear-gradient(var(--hi,#fff),var(--base,#888));
  box-shadow:
    0 0 0 3px #000,
    0 4px 0 0 rgba(0,0,0,.5),
    inset 0 2px 0 0 rgba(255,255,255,.45),
    inset 0 -2px 0 0 rgba(0,0,0,.35);
}
.pixel-button:hover{ filter:brightness(1.30); }
.pixel-button:active{
  filter:brightness(1.80); transform:translateY(2px);
  box-shadow:
    0 0 0 3px #000,
    0 2px 0 0 rgba(0,0,0,.5),
    inset 0 2px 0 0 rgba(255,255,255,.35),
    inset 0 -1px 0 0 rgba(0,0,0,.45);
}

/* Button colors */
.pixel-button[data-variant="green"]  { --hi:#86efac; --base:#22c55e; --txt:#0b0f19; }
.pixel-button[data-variant="blue"]   { --hi:#93c5fd; --base:#3b82f6; --txt:#0b0f19; }
.pixel-button[data-variant="purple"] { --hi:#d8b4fe; --base:#9333ea; --txt:#0b0f19; }
.pixel-button[data-variant="orange"] { --hi:#fdba74; --base:#f97316; --txt:#0b0f19; }
.pixel-button[data-variant="pink"]   { --hi:#f9a8d4; --base:#ec4899; --txt:#0b0f19; }
.pixel-button[data-variant="gray"]   { --hi:#e5e7eb; --base:#9ca3af; --txt:#0b0f19; }

/* Tile grid */
.tile-grid{
  position:absolute; left:50%; top:50%;
  transform:translate(-50%,-50%) scale(var(--scale,1));
  display:grid;
  grid-template-columns:repeat(var(--cols,24),var(--tile));
  grid-template-rows:repeat(var(--rows,18),var(--tile));
  width:calc(var(--cols,24) * var(--tile));
  height:calc(var(--rows,18) * var(--tile));
  z-index:1;
}
.sprite{
  width:var(--tile); height:var(--tile);
  background:center/contain no-repeat;
  image-rendering: pixelated;
}

/* NEXT button */
#nextButton{
  position:absolute; right:12px; bottom:12px; z-index:4;
}

/* Speech bubble */
.speech{
  position:absolute; left:50%; bottom:calc(100% - 32px);
  transform:translateX(-50%);
  max-width:clamp(220px,70%,720px);
  padding:10px 14px;
  background:#c1e1ff; color:#111;
  border:3px solid #000; border-radius:10px;
  font:700 clamp(12px,1.6vw,16px)/1.3 monospace;
  image-rendering: pixelated;
  z-index:3; display:none;
}
.speech[data-show="true"]{ display:block; }
.speech::after{
  content:"";
  position:absolute; left:28px; bottom:-7px;
  width:10px; height:10px; background:#fff;
  border-left:3px solid #000; border-bottom:3px solid #000;
  transform:rotate(45deg);
}

.enemy-speech{
  position:absolute; left:50%; bottom: -48px; transform:translateX(-50%);
  max-width:clamp(220px,70%,720px);
  padding:10px 14px;
  background:#50202e; color:#111;
  border:3px solid #000; border-radius:10px;
  font:700 #ffffff clamp(12px,1.6vw,16px)/1.3 monospace;
  image-rendering: pixelated;
  z-index:12; display:none;
}
.enemy-speech[data-show="true"]{ display:block; }
.enemy-speech::after{
  content:""; 
  position:absolute; left:28px; top:-7px;
  width:10px; height:10px; background:#fff;
  border-left:3px solid #000; border-bottom:3px solid #000;
  transform:rotate(45deg);
}

/* Credits */
.credits{
  position:absolute; inset:0;
  background:#000; color:#fff;
  z-index:3; overflow:hidden; display:none;
}
.credits[data-show="true"]{ display:block; }
.credits__inner{
  position:absolute; left:50%; bottom:-100%;
  transform:translateX(-50%);
  width:80%; max-width:720px; text-align:center;
  display:flex; flex-direction:column; gap:12px;
  font:700 16px/1.4 monospace;
  animation:credits-roll var(--credits-duration) linear forwards;
}
.credits__inner .title{ font-size:20px; margin-top:8px; }
@keyframes credits-roll{ from{bottom:-100%;} to{bottom:110%;} }

/* Toolbar */
.toolbar{
  position:absolute; left:50%; bottom:calc(50% + 260px);
  transform:translateX(-50%);
  max-width:clamp(220px,70%,720px);
  z-index:10000;
  display:flex; gap:10px; pointer-events:auto;
}
.toolbar button{
  padding:8px 14px;
  border:2px solid var(--attack-tint);
  box-shadow:
    inset 0 0 12px var(--attack-tint),
    0 0 10px color-mix(in srgb, var(--attack-tint), transparent 60%);
  background:rgba(0,0,0,.35); color:#fff;
  border-radius:10px;
  font:600 14px/1 system-ui, sans-serif;
}

/* toolbar cooldown visuals */
/* Toolbar container pinned above the game */
#toolbar{
  position:absolute; left:50%; bottom:calc(50% + 270px);
  transform:translateX(-50%);
  max-width:clamp(220px,70%,720px);
  display: flex;
  gap: 12px;
  z-index: 10000;
  pointer-events: auto;
}

/* Buttons stay in normal flow */
#toolbar button{   
  position: relative
}  
#toolbar button .cd{ margin-left:.5rem; font-weight:700; opacity:.9; }
#toolbar button[data-cooldown="1"]{ opacity:.58; cursor: not-allowed; }

/* Cooldown readout */
#toolbar button::after{
  content:"";
  position:absolute;
  left:8px; right:8px; bottom:-6px;
  height:3px; border-radius:2px;
  background:
    linear-gradient(to right,
      var(--attack-tint, #fd6f76) 0%,
      var(--attack-tint, #fd6f76) var(--cdp, 0%),
      rgba(255,255,255,.22) var(--cdp, 0%),
      rgba(255,255,255,.22) 100%);
}